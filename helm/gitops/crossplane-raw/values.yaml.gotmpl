resources:
  - apiVersion: external-secrets.io/v1
    kind: ExternalSecret
    metadata:
      name: &aws aws-secret
      labels:
    spec:
      refreshInterval: 1m
      secretStoreRef:
        kind: ClusterSecretStore
        name: aws
      target:
        name: *aws
        deletionPolicy: Delete
        creationPolicy: Owner
        template:
          type: Opaque
          data:
            creds: |
              [default]
              aws_access_key_id={{`{{.aws_access_key_id | toString }}`}}
              aws_secret_access_key={{`{{.aws_secret_access_key | toString }}`}}
      data:
        - secretKey: aws_access_key_id
          remoteRef:
            key: crossplane
            property: aws-access-key-id
        - secretKey: aws_secret_access_key
          remoteRef:
            key: crossplane
            property: aws-secret-access-key
  - apiVersion: aws.upbound.io/v1beta1
    kind: ProviderConfig
    metadata:
      name: aws
    spec:
      credentials:
        source: Secret
        secretRef:
          namespace: crossplane
          name: *aws
          key: creds
